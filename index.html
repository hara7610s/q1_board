<!DOCTYPE html>
<html lang="ja">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>スコアボード</title>
<style>
  body{
    background: #0b0b0c;
    color: #e6eef6;
    font-family:system-ui,'Noto Sans JP',sans-serif;
    margin:16px;
  }
  h1{font-size:20px;margin:0 0 12px;}
  h2{font-size:16px;margin:16px 0 8px;}
  table{border-collapse:collapse;width:100%}
  th,td{
    border-bottom:1px solid rgba(230,238,246,0.08);
    padding:8px;
    text-align:left;
  }
  th{background: rgba(230,238,246,0.03);}
  .muted{color:rgba(230,238,246,0.6);font-size:12px}
</style>
<body>
  <h1>恵比寿1R ウェディングアニバーサリーステークス</h1>
  <div class="muted">自動更新: 3秒ごと</div>

  <table id="tbl">
    <thead>
      <tr><th>順位</th><th>名前</th><th>得点</th></tr>
    </thead>
    <tbody></tbody>
  </table>

<script>
const GAS_URL = "https://script.google.com/macros/s/AKfycbxjl7vT0D__xcchipc7__nfW5pltwSjmnI6Dt_MZgzk8wKh3U0i_7BEK8D9ONMT0Lty/exec?fn=ranking";

// 各pickの重み（得点）
const POINTS = { pick1: 3, pick2: 2, pick3: 1 };

async function fetchRanking(){
  const res = await fetch(GAS_URL, { cache:'no-store' });
  const json = await res.json();
  if(!json.ok) return;

  // スコア集計
  const scoreMap = {};
  Object.entries(POINTS).forEach(([key, weight]) => {
    Object.entries(json.popularity[key] || {}).forEach(([name, cnt]) => {
      scoreMap[name] = (scoreMap[name] || 0) + cnt * weight;
    });
  });

  // 降順にソート
  const sorted = Object.entries(scoreMap);
    // .sort((a, b) => b[1] - a[1] || a[0].localeCompare(b[0], 'ja'));

  // 表示
  const tbody = document.querySelector('#tbl tbody');
  tbody.innerHTML = '';
  sorted.forEach(([name, score], i) => {
    const tr = document.createElement('tr');
    const tdRank = document.createElement('td');
    const tdName = document.createElement('td');
    const tdScore = document.createElement('td');
    tdRank.textContent = i + 1;
    tdName.textContent = name;
    tdScore.textContent = score;
    tr.append(tdRank, tdName, tdScore);
    tbody.appendChild(tr);
  });
}

fetchRanking();
setInterval(fetchRanking, 3000);
</script>
</body>
</html>
